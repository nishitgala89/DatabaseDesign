1)	Quantitative Analysis of Range of Wines on the Wine-Stopper Website

The results are on the basis of Country, Colour, Category of Wine
SELECT WC.COUNTRY_NAME, WD.COLOUR,WCAT.CATEGORY_NAME , COUNT(WINE_CODE)  NO_OF_WINES
FROM WS_WINE W, WS_COUNTRY WC, WS_WINE_DETAILS WD , WS_WINE_CATEGORY WCAT
WHERE W.WINE_DTL_ID = WD.WINE_DTL_ID 
AND WD.COUNTRY_CODE = WC.COUNTRY_CODE
AND WD.CATEGORY_ID = WCAT.CATEGORY_ID
GROUP BY WC.COUNTRY_NAME, WD.COLOUR,WCAT.CATEGORY_NAME
ORDER BY NO_OF_WINES DESC




2)	Selection of Wines with information about Special Offers, Availability 
User has an option to filter by Wine Category of General, Sparkling and Dessert Wines 
User has an option to select the colour of the wine 
User has an option to set the country of the wine
The Center ID has to be provided on the basis of User location 

SELECT  W.WINE_CODE, WD.WINE_NAME || '  ' ||  W.CASE_SIZE_IN_LTR  || ' LTR' AS "WINE_NAME" ,
WD.WINE_DESC AS WINE_DESC , WI.IND_DESC AS WINE_INDICATOR, W.PRICE_PER_BOTTLE AS "BOTTLE(£)", W.PRICE_PER_CASE AS "CASE(£)",
W.NUM_OF_BOTTLE || ' X ' ||  W.BOTTLE_SIZE_IN_ML AS "CASE CONTAINS",
CASE WHEN  WS.NEXT_DELIVERY IS NOT NULL AND WS.QUANTITY <= 0 THEN  'AVAILABLE IN ' ||  TO_CHAR(WS.NEXT_DELIVERY - TRUNC(SYSDATE)) || ' DAYS'
     WHEN  WS.NEXT_DELIVERY IS NULL AND WS.QUANTITY <= 0 THEN  'UNAVAILABLE'
     WHEN  WS.QUANTITY > 0 THEN  'IN STOCK'
END AS AVAILABILITY,
CASE 
    WHEN  WP.DISCOUNT_PERCENT > 0 
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
    THEN WP.DISCOUNT_PERCENT || ' % OFF'

     WHEN WP.DISCOUNT_QUANTITY_BUY > 0 AND  WP.DISCOUNT_QUANTITY_FOR > 0 
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'BUY ' || WP.DISCOUNT_QUANTITY_BUY || ' FOR ' || DISCOUNT_QUANTITY_FOR 
WHEN WP.RED_PRICE_PER_CASE > 0  AND   WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE ||   ', REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
     
     WHEN WP.RED_PRICE_PER_CASE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE
     
     WHEN WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
END AS SPECIAL_OFFER
FROM WS_WINE W, WS_WINE_DETAILS WD, WS_COUNTRY WC, WS_WINE_INDICATOR WI,
WS_PROMOTION WP, WS_WINE_CATEGORY WCAT, WS_STOCK_INFO WS
WHERE W.WINE_DTL_ID = WD.WINE_DTL_ID
AND WD.COUNTRY_CODE = WC.COUNTRY_CODE
AND WD.IND_ID = WI.IND_ID
AND WD.CATEGORY_ID = WCAT.CATEGORY_ID
AND W.WINE_CODE = WP.WINE_CODE(+)
AND W.WINE_CODE = WS.WINE_CODE
AND UPPER(WCAT.CATEGORY_NAME) LIKE COALESCE('','%') --  REGULAR, SPARKLING, DESSERT
AND UPPER(WD.COLOUR) LIKE COALESCE('','%') -- RED, WHITE, GOLD, ROSE, YELLOW, ORANGE
AND UPPER(WC.COUNTRY_NAME) LIKE COALESCE('','%')  -- UNITED STATES, FRANCE, GERMANY, ITALY
WHEN WP.RED_PRICE_PER_CASE > 0  AND   WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE ||   ', REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
     
     WHEN WP.RED_PRICE_PER_CASE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE
     
     WHEN WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
END AS SPECIAL_OFFER
FROM WS_WINE W, WS_WINE_DETAILS WD, WS_COUNTRY WC, WS_WINE_INDICATOR WI,
WS_PROMOTION WP, WS_WINE_CATEGORY WCAT, WS_STOCK_INFO WS
WHERE W.WINE_DTL_ID = WD.WINE_DTL_ID
AND WD.COUNTRY_CODE = WC.COUNTRY_CODE
AND WD.IND_ID = WI.IND_ID
AND WD.CATEGORY_ID = WCAT.CATEGORY_ID
AND W.WINE_CODE = WP.WINE_CODE(+)
AND W.WINE_CODE = WS.WINE_CODE
AND UPPER(WCAT.CATEGORY_NAME) LIKE COALESCE('','%') --  REGULAR, SPARKLING, DESSERT
AND UPPER(WD.COLOUR) LIKE COALESCE('','%') -- RED, WHITE, GOLD, ROSE, YELLOW, ORANGE
AND UPPER(WC.COUNTRY_NAME) LIKE COALESCE('','%')  -- UNITED STATES, FRANCE, GERMANY, ITALY
AND WS.CENTER_ID=1 -- #1,2,3 DEPENDING UPON THE LOCATION DETECTED 
ORDER BY 1 



3)	On Promotion Wines
SELECT  W.WINE_CODE, WD.WINE_NAME || '  ' ||  W.CASE_SIZE_IN_LTR  || ' LTR' AS "WINE_NAME" ,
WD.WINE_DESC AS WINE_DESC , WI.IND_DESC AS WINE_INDICATOR, W.PRICE_PER_BOTTLE AS "BOTTLE(£)", W.PRICE_PER_CASE AS "CASE(£)",
W.NUM_OF_BOTTLE || ' X ' ||  W.BOTTLE_SIZE_IN_ML AS "CASE CONTAINS",
CASE WHEN  WS.NEXT_DELIVERY IS NOT NULL AND WS.QUANTITY <= 0 THEN  'AVAILABLE IN ' ||  TO_CHAR(WS.NEXT_DELIVERY - TRUNC(SYSDATE)) || ' DAYS'
     WHEN  WS.NEXT_DELIVERY IS NULL AND WS.QUANTITY <= 0 THEN  'UNAVAILABLE'
     WHEN  WS.QUANTITY > 0 THEN  'IN STOCK'
END AS AVAILABILITY,
CASE 
    WHEN  WP.DISCOUNT_PERCENT > 0 
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
    THEN WP.DISCOUNT_PERCENT || ' % OFF'

     WHEN WP.DISCOUNT_QUANTITY_BUY > 0 AND  WP.DISCOUNT_QUANTITY_FOR > 0 
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'BUY ' || WP.DISCOUNT_QUANTITY_BUY || ' FOR ' || DISCOUNT_QUANTITY_FOR 
     
     WHEN WP.RED_PRICE_PER_CASE > 0  AND   WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE ||   ', REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
     
     WHEN WP.RED_PRICE_PER_CASE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || WP.RED_PRICE_PER_CASE
     
     WHEN WP.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
          AND WP.STATUS = 'Active'
     THEN 'REDUCED PRICE PER BOTTLE (£): ' || WP.RED_PRICE_PER_BOTTLE
END AS SPECIAL_OFFER
FROM WS_WINE W, WS_WINE_DETAILS WD, WS_COUNTRY WC, WS_WINE_INDICATOR WI,
WS_PROMOTION WP, WS_WINE_CATEGORY WCAT, WS_STOCK_INFO WS
WHERE W.WINE_DTL_ID = WD.WINE_DTL_ID
AND WD.COUNTRY_CODE = WC.COUNTRY_CODE
AND WD.IND_ID = WI.IND_ID
AND WD.CATEGORY_ID = WCAT.CATEGORY_ID
AND W.WINE_CODE = WP.WINE_CODE
AND W.WINE_CODE = WS.WINE_CODE
AND UPPER(WCAT.CATEGORY_NAME) LIKE COALESCE('','%') --  REGULAR, SPARKLING, DESSERT
AND UPPER(WD.COLOUR) LIKE COALESCE('','%') -- RED, WHITE, GOLD, ROSE, YELLOW, ORANGE
AND UPPER(WC.COUNTRY_NAME) LIKE COALESCE('','%')  -- USA, FRANCE, GERMANY, ITALY
AND WS.CENTER_ID=1 -- #1,2,3 DEPENDING UPON THE LOCATION DETECTED 
and TRUNC(SYSDATE) BETWEEN WP.START_DATE AND WP.EXPIRY_DATE
ORDER BY 1




4)	Data shown in the User Shopping Basket before the purchase

SELECT CUST.FNAME ,CUST.LNAME ,
WDET.WINE_NAME || '  ' ||  WINE.CASE_SIZE_IN_LTR  || ' LTR' AS "WINE_NAME" , WINE.WINE_CODE,
COUNTRY.COUNTRY_NAME AS "COUNTRY",  WDET.COLOUR AS "COLOUR", 
WINE.PRICE_PER_BOTTLE AS "BOTTLE(£)", WINE.PRICE_PER_CASE AS "CASE(£)", 
CASE WHEN  WS.NEXT_DELIVERY IS NOT NULL AND WS.QUANTITY <= 0 THEN  'AVAILABLE IN ' ||  TO_CHAR(WS.NEXT_DELIVERY - TRUNC(SYSDATE)) || ' DAYS'
     WHEN  WS.NEXT_DELIVERY IS NULL AND WS.QUANTITY <= 0 THEN  'UNAVAILABLE'
     WHEN  WS.QUANTITY > 0 THEN  'IN STOCK'
END AS AVAILABILITY,
CASE 
    WHEN  PROMO.DISCOUNT_PERCENT > 0 
          AND TRUNC(SYSDATE) BETWEEN PROMO.START_DATE AND PROMO.EXPIRY_DATE
          AND PROMO.STATUS = 'Active'
    THEN PROMO.DISCOUNT_PERCENT || ' % OFF'

     WHEN PROMO.DISCOUNT_QUANTITY_BUY > 0 AND  PROMO.DISCOUNT_QUANTITY_FOR > 0 
          AND TRUNC(SYSDATE) BETWEEN PROMO.START_DATE AND PROMO.EXPIRY_DATE
          AND PROMO.STATUS = 'Active'
     THEN 'BUY ' || PROMO.DISCOUNT_QUANTITY_BUY || ' FOR ' || DISCOUNT_QUANTITY_FOR 
     
     WHEN PROMO.RED_PRICE_PER_CASE > 0  AND   PROMO.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN PROMO.START_DATE AND PROMO.EXPIRY_DATE
          AND PROMO.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || PROMO.RED_PRICE_PER_CASE ||   ', REDUCED PRICE PER BOTTLE (£): ' || PROMO.RED_PRICE_PER_BOTTLE
     

     WHEN PROMO.RED_PRICE_PER_CASE > 0  
          AND TRUNC(SYSDATE) BETWEEN PROMO.START_DATE AND PROMO.EXPIRY_DATE
          AND PROMO.STATUS = 'Active'
     THEN 'REDUCED PRICE PER CASE (£): ' || PROMO.RED_PRICE_PER_CASE
     
     WHEN PROMO.RED_PRICE_PER_BOTTLE > 0  
          AND TRUNC(SYSDATE) BETWEEN PROMO.START_DATE AND PROMO.EXPIRY_DATE
          AND PROMO.STATUS = 'Active'
     THEN 'REDUCED PRICE PER BOTTLE (£): ' || PROMO.RED_PRICE_PER_BOTTLE

END AS "SPECIAL OFFER",
BASKET.SELECTION_TYPE || ' : ' || BASKET.QUANTITY AS "QUANTITY REQUESTED"
FROM WS_SHOPPING_BASKET BASKET, WS_CUSTOMER CUST, WS_WINE WINE, WS_WINE_DETAILS WDET, WS_COUNTRY COUNTRY, WS_PROMOTION PROMO, WS_STOCK_INFO WS
WHERE BASKET.CUST_ID = CUST.CUST_ID
AND BASKET.WINE_CODE = WINE.WINE_CODE
AND WINE.WINE_DTL_ID = WDET.WINE_DTL_ID 
AND WDET.COUNTRY_CODE = COUNTRY.COUNTRY_CODE 
AND WINE.WINE_CODE = PROMO.WINE_CODE(+) 
AND WS.WINE_CODE= WINE.WINE_CODE
AND CUST.CENTER_ID = WS.CENTER_ID
AND UPPER(CUST.FNAME) LIKE 'FRED'
AND UPPER(CUST.LNAME) LIKE 'SMITH' -- DANIEL JAMES, FRED SMITH
AND BASKET.STATUS = 'Pending' 



5)	Invoice Data post the Purchase is made

Part A – Displaying the purchased items with selling price, discount, total price for a customer on basis of either customer name or order no


SELECT   INV.INVOICE_NO, INV.INVOICE_DATE, CUST.FNAME ,CUST.LNAME ,
WDET.WINE_NAME || '  ' ||  WINE.CASE_SIZE_IN_LTR  || ' LTR' AS "WINE_NAME",
BASKET.DELIVERY_DATE,
BASKET.SELECTION_TYPE || ' : ' || BASKET.QUANTITY AS "QUANTITY_REQUESTED" ,
CASE WHEN BASKET.SELECTION_TYPE = 'BOTTLE' THEN WINE.PRICE_PER_BOTTLE 
     WHEN BASKET.SELECTION_TYPE = 'CASE' THEN WINE.PRICE_PER_CASE END AS "ITEM_PRICE (£)",
 '(' || BASKET.DISCOUNT_AMOUNT || ')'  AS "DISCOUNT (£)",
BASKET.SELLING_PRICE AS "TOTAL_COST (£)"
FROM WS_SHOPPING_BASKET BASKET, WS_CUSTOMER CUST, WS_WINE WINE, WS_WINE_DETAILS WDET, WS_INVOICE INV
WHERE BASKET.CUST_ID = CUST.CUST_ID
AND BASKET.WINE_CODE = WINE.WINE_CODE
AND WINE.WINE_DTL_ID = WDET.WINE_DTL_ID 
AND CUST.CUST_ID = INV.CUST_ID
AND BASKET.STATUS = 'Ordered'  -- Status - Pending (for items in Basket), Ordered (for items ordered with Invoice generated)
AND UPPER(CUST.FNAME) LIKE COALESCE('FRED', '%') AND UPPER(CUST.LNAME) LIKE COALESCE('SMITH', '%')  -- DANIEL JAMES, FRED SMITH
AND INV.INVOICE_NO LIKE COALESCE('', '%') --- INVOICE NO FROM WS_INVOICE TABLE James - 32578, Smith - 34612
--- WDET.WINE_NAME || '  ' ||  WINE.CASE_SIZE_IN_LTR  || ' LTR' AS "WINE_NAME",
BASKET.DELIVERY_DATE,
BASKET.SELECTION_TYPE || ' : ' || BASKET.QUANTITY AS "QUANTITY_REQUESTED" ,
CASE WHEN BASKET.SELECTION_TYPE = 'BOTTLE' THEN WINE.PRICE_PER_BOTTLE 
     WHEN BASKET.SELECTION_TYPE = 'CASE' THEN WINE.PRICE_PER_CASE END AS "ITEM_PRICE (£)",
 '(' || BASKET.DISCOUNT_AMOUNT || ')'  AS "DISCOUNT (£)",
BASKET.SELLING_PRICE AS "TOTAL_COST (£)"
FROM WS_SHOPPING_BASKET BASKET, WS_CUSTOMER CUST, WS_WINE WINE, WS_WINE_DETAILS WDET, WS_INVOICE INV
WHERE BASKET.CUST_ID = CUST.CUST_ID
AND BASKET.WINE_CODE = WINE.WINE_CODE
AND WINE.WINE_DTL_ID = WDET.WINE_DTL_ID 
AND CUST.CUST_ID = INV.CUST_ID
AND BASKET.STATUS = 'Ordered'  -- Status - Pending (for items in Basket), Ordered (for items ordered with Invoice generated)
AND UPPER(CUST.FNAME) LIKE COALESCE('FRED', '%') AND UPPER(CUST.LNAME) LIKE COALESCE('SMITH', '%')  -- DANIEL JAMES, FRED SMITH
AND INV.INVOICE_NO LIKE COALESCE('', '%') --- INVOICE NO FROM WS_INVOICE TABLE James - 32578, Smith - 34612

---- Note – Status is Ordered when order invoice is generated



